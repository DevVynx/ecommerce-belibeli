generator client {
  provider = "prisma-client"
  output   = "./generated/client"
}

datasource db {
  provider = "postgresql"
}

model User {
  id        String    @id @default(uuid()) @db.Uuid
  name      String
  email     String    @unique
  password  String
  cart      Cart?
  createdAt DateTime  @default(now()) @map("created_at") @db.Timestamptz
  updatedAt DateTime  @updatedAt @map("updated_at") @db.Timestamptz
  wishlist  Wishlist?

  @@map("users")
}

model Category {
  id        String    @id @default(uuid()) @db.Uuid
  name      String    @unique
  createdAt DateTime  @default(now()) @map("created_at") @db.Timestamptz
  updatedAt DateTime  @updatedAt @map("updated_at") @db.Timestamptz
  products  Product[]

  @@map("categories")
}

model Product {
  id             String    @id @default(uuid()) @db.Uuid
  title          String
  price          Decimal   @db.Decimal(10, 2)
  description    String    @db.Text
  image          String
  promotionPrice Decimal?  @map("promotion_price") @db.Decimal(10, 2)
  promotionEnd   DateTime? @map("promotion_end") @db.Timestamptz
  stock          Int       @default(0)
  totalSold      Int       @default(0) @map("total_sold")
  ratingRate     Decimal   @default(0) @map("rating_rate") @db.Decimal(3, 2)
  ratingCount    Int       @default(0) @map("rating_count")
  createdAt      DateTime  @default(now()) @map("created_at") @db.Timestamptz
  updatedAt      DateTime  @updatedAt @map("updated_at") @db.Timestamptz

  cartItems      CartItem[]
  productOptions ProductOption[]

  categoryId    String         @map("category_id") @db.Uuid
  category      Category       @relation(fields: [categoryId], references: [id], onDelete: Cascade)
  wishlistItems WishlistItem[]

  @@index([categoryId])
  @@index([createdAt])
  @@map("products")
}

model ProductOption {
  id              String               @id @default(uuid()) @db.Uuid
  type            String
  values          ProductOptionValue[]
  cartItemOptions CartItemOption[]

  productId String  @map("product_id") @db.Uuid
  product   Product @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@index([productId])
  @@map("product_options")
}

model ProductOptionValue {
  id              String           @id @default(uuid()) @db.Uuid
  value           String
  cartItemOptions CartItemOption[]

  productOptionId String        @map("product_option_id") @db.Uuid
  productOption   ProductOption @relation(fields: [productOptionId], references: [id], onDelete: Cascade)

  @@index([productOptionId])
  @@map("product_option_values")
}

model Cart {
  id        String     @id @default(uuid()) @db.Uuid
  createdAt DateTime   @default(now()) @map("created_at") @db.Timestamptz
  updatedAt DateTime   @updatedAt @map("updated_at") @db.Timestamptz
  items     CartItem[]

  userId String @unique @map("user_id") @db.Uuid
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("carts")
}

model CartItem {
  id          String   @id @default(uuid()) @db.Uuid
  quantity    Int      @default(1)
  variantHash String   @map("variant_hash")
  createdAt   DateTime @default(now()) @map("created_at") @db.Timestamptz
  updatedAt   DateTime @updatedAt @map("updated_at") @db.Timestamptz

  productOptions CartItemOption[]

  productId  String  @map("product_id") @db.Uuid
  cartId     String  @map("cart_id") @db.Uuid
  product    Product @relation(fields: [productId], references: [id], onDelete: Cascade)
  cart       Cart    @relation(fields: [cartId], references: [id], onDelete: Cascade)
  wishlistId String? @db.Uuid

  @@unique([cartId, productId, variantHash])
  @@index([cartId])
  @@index([productId])
  @@map("cart_items")
}

model CartItemOption {
  id String @id @default(uuid()) @db.Uuid

  optionId      String @map("option_id") @db.Uuid
  optionValueId String @map("option_value_id") @db.Uuid
  cartItemId    String @map("cart_item_id") @db.Uuid

  option         ProductOption      @relation(fields: [optionId], references: [id], onDelete: Cascade)
  optionValue    ProductOptionValue @relation(fields: [optionValueId], references: [id], onDelete: Cascade)
  cartItem       CartItem           @relation(fields: [cartItemId], references: [id], onDelete: Cascade)
  wishlistItemId String?            @db.Uuid

  @@unique([cartItemId, optionId])
  @@index([cartItemId])
  @@index([optionId])
  @@index([optionValueId])
  @@map("cart_items_options")
}

model Wishlist {
  id        String         @id @default(uuid()) @db.Uuid
  createdAt DateTime       @default(now()) @map("created_at") @db.Timestamptz
  updatedAt DateTime       @updatedAt @map("updated_at") @db.Timestamptz
  items     WishlistItem[]

  userId String @unique @map("user_id") @db.Uuid
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("wishlists")
}

model WishlistItem {
  id        String   @id @default(uuid()) @db.Uuid
  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz
  updatedAt DateTime @updatedAt @map("updated_at") @db.Timestamptz

  productId  String   @map("product_id") @db.Uuid
  wishlistId String   @map("cart_id") @db.Uuid
  product    Product  @relation(fields: [productId], references: [id], onDelete: Cascade)
  wishlist   Wishlist @relation(fields: [wishlistId], references: [id], onDelete: Cascade)

  @@unique([wishlistId, productId])
  @@index([wishlistId])
  @@index([productId])
  @@map("wishlist_items")
}
